\documentclass[pdftex,12pt,a4paper]{report}

\usepackage[portuguese,english]{babel}
\usepackage[T1]{fontenc} 
\usepackage[table,xcdraw]{xcolor}
\usepackage[utf8]{inputenc}
\usepackage[pdftex]{graphicx}
\usepackage{minitoc}
\usepackage{hyperref}
\usepackage{indentfirst}
\usepackage[compact]{titlesec}
\usepackage{fancyhdr}
\usepackage{caption}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\usepackage{fixltx2e}
\usepackage{mathtools}
\usepackage{fancyhdr}
\usepackage{listings}
\usepackage{color}
\usepackage{sverb}
\usepackage[section]{placeins}
\usepackage{adjustbox}
\titleformat*{\subsubsection}{\itshape}


%Highlight
\newcommand{\shellcmd}[1]{\indent\indent\texttt{\footnotesize\# #1}\\}

\pagestyle{fancy}
\renewcommand*\thesection{\thechapter\arabic{section}}
\newcommand{\HRule}{\rule{\linewidth}{0.5mm}}
\begin{document}

\input{./titulo.tex} %Titulo do Relatorio
\renewcommand{\headrulewidth}{0pt}

%Cabeçalhos de rodapé
\fancyhead{}
\fancyfoot{}
\lhead{Network Traffic Engineering}
\rhead{DDR - 2015/2016}
\lfoot{Rafael Ferreira nmec: 67405 \\ Rodrigo Cunha nmec: 67800}
\rfoot{\thepage}

%Renomear Comandos
\renewcommand*\contentsname{Conteúdos}
\renewcommand*\figurename{Figura}
\renewcommand*\tablename{Tabela}

%Conteúdos, dar paragrafo
\tableofcontents
%Headers
\renewcommand{\headrulewidth}{0.15pt}
\renewcommand{\thechapter}{}



\clearpage

\section{Exercício 1}

Para iniciar este trabalho foi-nos dado vários ficheiros de base. O ficheiro NetGen.py é responsável por gerar uma rede, com vários nós que inclui o nome e localização geográfica, e as ligações inter-nó, matrizes de tráfego que define os fluxos de tráfego entre todas as cidades/ nós.

A localização geográfica (pos) é obtida dinamicamente a partir do nome do no (nome da cidade) usando a API do Google Maps, ficheiro getGeo.py. 

A matriz de tráfego (TM) é gerado aleatóriamente. É possível também guardar o resultado num ficheiro .dat e passando como argumento o parâmetro -f, net.dat.

\begin{figure}[!htb]
  \centering
  \begin{minipage}[b]{0.4\textwidth}
    \includegraphics[width=\textwidth]{imagensGuia/esquema_rede_pequena.png}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.4\textwidth}
    \includegraphics[width=\textwidth]{imagensGuia/esquema_rede_grande.png}
  \end{minipage}
  \caption{Rede pequena de teste e rede grande}
\end{figure}


\section{Exercício 2, 3 e 4}

No exercício 2 é usado o caminho mais curto como escolha para o caminho entre pontos, sendo que isto é dado pela soma das conexões e usando o algoritmo Greedy.

No exercício 3, foi calculado o "average one-way delay" e a carga em todas as direções em todos os links.

Para isso, para calcular o "average one-way delay", foi usada a seguinte fórmula baseada na aproximação Kleinrock:

$\mu$ = 1e9 / 8000 , é igual ao link speed em pkts/sec (1Gbps)

\[W = 1e6\times\left[\frac{1}{\left(\mu-atraso\right)}\right]\]

Para calcular o atraso, teve de se criar um ciclo de forma a percorrer todos os links e criar uma lista com os atrasos.

\begin{lstlisting}[language=python]
for pair in allpairs:
    path = sol[pair]
    for i in range(0, len(path) - 1):
        ws_delay[pair] = 1e6 / (mu - \
        net[path[i]][path[i + 1]]['load'])
\end{lstlisting}

Após isso foi possível apresentar a seguinte tabela para a rede pequena:

\input{./tables/smallnet_netTE1.tex}

Analisando a tabela obtida conseguimos perceber que o link Aveiro-Porto tem o máximo delay de 16.14 micro segundos e a carga máxima está de Aveiro ao Porto com 63050 pacotes/ segundo.

\input{./tables/smallnet_netTE1_stats1.tex}

\input{./tables/smallnet_netTE1_stats2.tex}

Para a rede grande, obteve-se o máximo delay de 16.25 micro segundos e a carga máxima de Aveiro-Porto com 63497 pacotes/ segundo.

\input{./tables/network_netTE1_stats1.tex}

\input{./tables/network_netTE1_stats2.tex}

\newpage

\section{Exercício 5, 6 e 7}

No exercício 5 foi pedido que o routing agora fosse feito usando como parâmetro de escolha a menor carga possível, otimizando assim a largura de banda disponível  ao longo do caminho.

A nível de código, a única mudança efetuada importante foi:
\begin{lstlisting}[language=python]
path = nx.shortest_path(net, pair[0], pair[1], weight='load')
\end{lstlisting}

Pois agora o critério para escolha do caminho mais curto é a carga.

Para a rede pequena o resultado obtido foi:

\input{./tables/smallnet_netTE2.tex}

Analisando a tabela e os resultados obtidos conseguimos perceber que houve mudança na distribuição dos caminhos mais curtos, por exemplo, Porto > Lisboa agora o caminho é feito por Porto, Viseu e Lisboa, já de Lisboa > Porto é feito por Lisboa, Viseu, Porto.

Este resultado é explicado porque a lista de pares da rede pequena está distribuída da seguinte forma:

\begin{lstlisting}[language=python]
[('Lisboa', 'Viseu'), ('Lisboa', 'Aveiro'),
('Lisboa', 'Porto'), ('Viseu', 'Lisboa'), ('Viseu', 'Aveiro'),
('Viseu', 'Porto'), ('Aveiro', 'Lisboa'), ('Aveiro', 'Viseu'), 
('Aveiro', 'Porto'), ('Porto', 'Lisboa'), ('Porto', 'Viseu'),
('Porto', 'Aveiro')]
\end{lstlisting}

Inicialmente, irá testar a ligação Lisboa > Viseu, à qual será atribuída, depois Lisboa > Aveiro e será também atribuída, de seguida, Lisboa > Porto, como o somatório das cargas entre as ligações Lisboa > Viseu (31271) + Viseu > Porto (0) tem menos carga do que a Lisboa > Aveiro (31345) + Aveiro > Porto (0) então seleciona ir por Viseu, daí a diferença nos resultados em relação ao primeiro exercício.
 
Na diferença de Porto > Lisboa, temos Porto > Aveiro (0)  + Aveiro > Lisboa (31188) com mais carga do que Porto > Viseu (0) + Viseu > Lisboa (31171) no momento de atribuição, o que faz com que seja selecionado o caminho: Porto > Viseu > Lisboa.

\input{./tables/smallnet_netTE2_stats1.tex}

\input{./tables/smallnet_netTE2_stats2.tex}

Com este exercício, mudando o critério para carga nos links na escolha do caminho mais curto, conseguimos melhorias no "maximum one-way delay" de (-0,108 microseg)   e no "maximum one-way load" (-319 pkts/sec). 

%32.1869758326-32.0852532284=0,1017226042 micro sec
%63050.00-62731.00=319 pkts/sec

Já para a rede grande, dado que o critério agora é a carga, as mudanças são superiores ao exercício anterior, conseguindo-se melhorias no "maximum one-way delay" de (-5.109 microseg)   e no "maximum one-way load" (-28182 pkts/sec).  

%16.2593694617-11.1501365892=5.1092328725 micro sec
%63497.00-35315.00=28182 pkts/sec

\input{./tables/network_netTE2_stats1.tex}

\input{./tables/network_netTE2_stats2.tex}

\section{Exercício 8, 9 e 10}

No exercício 8 pretende-se que seja escolhido o caminho mais curto tendo em conta o atraso, minimizando assim o "average one-way delay". Este por sua vez irá sempre escolher de forma sequencial, o que fará com que seja sempre na mesma ordem.

A nível de código, a única mudança efetuada importante foi:
\begin{lstlisting}[language=python]
path = nx.shortest_path(net, pair[0], pair[1],
	 weight='delay')
...
net[path[i]][path[i + 1]]['delay'] = 1e6 / 
	(mu - net[path[i]][path[i + 1]]['load'])
\end{lstlisting}

O critério agora é o atraso, e para calcular o atraso usou-se a aproximação M/M/1.

Para a rede pequena o resultado obtido foi:

\input{./tables/smallnet_netTE3.tex}

Nesta tabela em relação ao exercício anterior não houve mudanças, isto devido à ordem ser a mesma de atribuição.

\newpage

\input{./tables/smallnet_netTE3_stats1.tex}

\input{./tables/smallnet_netTE3_stats2.tex}

Como se pode observar, para a rede pequena manteve-se igual.

Já para a rede grande, neste caso, não existiu melhorias, no "maximum one-way delay" de (+0,011 microseg)   e no "maximum one-way load" (+88 pkts/sec).  

%11.1501365892-11.1610879829=+0,0109513937 micro sec
%35315.00-35403.00=+88 pkts/sec

\input{./tables/network_netTE3_stats1.tex}

\input{./tables/network_netTE3_stats2.tex}

\section{Exercício 11 e 12}

No exercício 11 e 12, foi pedido que usando um método que aleatoriamente trocasse os elementos de uma lista e fazendo isto para um número de vezes finito, de forma a obter sempre os melhores resultados tendo em conta o atraso. Para isto, foi usado o código do exercício anterior, adicionado um for para iterar e mais umas pequenas mudanças.

Para a rede pequena o resultado obtido foi:

\input{./tables/smallnet_netTE4.tex}



\newpage



\end{document}



